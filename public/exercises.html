<!DOCTYPE html>
<html>
<head>
  <title>View Exercise</title>
  <link rel="stylesheet" href="styles/exercises.css"/>
</head>
<body>
  <h1>Exercise Details</h1>
  <div id="exercise-details"></div>
  <div id="back"></div>

  <script>
    async function loadExercise() {
      const urlParams = new URLSearchParams(window.location.search);
      const lessonId = urlParams.get('lesson_id');
      const exerciseId = urlParams.get('exercise_id');
  
      if (!lessonId || !exerciseId) {
        document.getElementById('exercise-details').innerText = 'Missing lesson_id or exercise_id in URL';
        return;
      }
  
      // Fetch the exercise details
      const exerciseRes = await fetch(`/api/exercises?lesson_id=${lessonId}`);
      let exercises = [];
      try {
        exercises = await exerciseRes.json();
      } catch (e) {
        console.error("Failed to parse exercises JSON:", e);
        document.getElementById('exercise-details').innerText = 'Failed to load exercise data';
        return;
      }

      const exercise = exercises.find(ex => ex.id === exerciseId);
      if (!exercise) {
        document.getElementById('exercise-details').innerText = 'Exercise not found';
        return;
      }
  
      console.log(exercise);

      // Display exercise details
      let html = `<h2>${exercise.prompt}</h2>`;
      if (exercise.type === 'multiple_choice') {
        const options = JSON.parse(exercise.options); // array of strings
        const correctIndex = exercise.correct_answer; // assuming your API includes this
  
        html += `<div>`;
          options.forEach((option, i) => {
            html += `<button onclick='answer(${JSON.stringify(option)}, ${JSON.stringify(correctIndex)})'>${option}</button>`;
          });
        html += `</div>`;
      }
  
      document.getElementById('exercise-details').innerHTML = html;
      document.getElementById('back').innerHTML = `<a href="lessons?lesson_id=${lessonId}">Back</a>`;
    }
  
    function answer(selectedValue, correctValue) {
      if (selectedValue === correctValue) {
        alert("✅ Correct!");
      } else {
        alert("❌ Incorrect. Try again!");
      }
    }

  
    loadExercise();
  </script>  
</body>
</html>
